
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Tasks</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <style>
        .displaySavedTasks{
            width:100%;
            height: 800px;
            overflow: auto;
           
            margin-top: 10px;
            margin-left: 10px;
            
        }
        table{
            padding-left: 100px;
            overflow: auto;
            
        }
    </style>

</head>
<body>
    
<h1>Your Taska will display here.</h1>
<p id = "username"></p>
<p id = "emailDis"></p>
<p id = "emailDis1"></p>





<div class = "displaySavedTasks"  id = "databaseDisplayer">
       
    <label class="currentTasksLable">Tasks</label> 

      <div class="container mt-3">
        <table class="table">
          <thead>
            <th>Number</th>
            <th>Task Id</th>
            <th>Task Name</th>
            <th>Task Details</th>
            <th>Task Start Dtae</th>
            <th>Task End Date</th> 
            <th>Task Assign To</th>
          
          </thead>
          <tbody id = "tbody1"></tbody>
        </table>
      </div>
   
  </div>


    <script type="module">

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-analytics.js";
       
        const firebaseConfig = {
          apiKey: "AIzaSyD5JiYR8U0fZ3SH-aE3bs_azy_tVGCF1fk",
          authDomain: "java-script-project-fe70e.firebaseapp.com",
          projectId: "java-script-project-fe70e",
          storageBucket: "java-script-project-fe70e.appspot.com",
          messagingSenderId: "333637297039",
          appId: "1:333637297039:web:e1e4e9053f3ef7003461fa",
          measurementId: "G-1791Q3L03T"
        };

        import { getAuth, onAuthStateChanged} from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
     
      
        import {getDatabase, ref, set, child, get, onValue, query, limitToFirst, limitToLast, orderByChild, startAt, startAfter, endAt, endBefore, equalTo} 
        from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth();
        const database = getDatabase();
        const user = auth.currentUser;

       
   

   //Check if signed in
onAuthStateChanged(auth, (user) => {

   

    if (user !== null) {
     

        get(ref(database, 'Users/'+ user.uid))
        .then(function(snaphot) {
        
        // console.log(user);

        var loginUser = document.getElementById('emailDis');
      

            document.getElementById('username').innerHTML =  snaphot.val().User_name;
            
            let loggedUser = "" 
            loggedUser = snaphot.val().Email_address;
            valueFound(loggedUser)         
           // console.log(loginUser);
  


        })
        
    } 
    else {

        document.getElementById("username").innerText = "Not abale to get data ";
        console.log("user is null.");
        
    }
    
   });



   function valueFound(userlogged)
   {
    document.getElementById('emailDis').innerHTML = "Email " + userlogged;
    let convertToString = String(userlogged);
    getAllDataOnce (convertToString);
  

    console.log(convertToString);
   }

   
   //console.log(valueFound(userlogged));

   
   
           
        //this will add items to the table

        let taskid = 0;
        const tbody = document.getElementById('tbody1');
       
   
        function addItemsToTable(taskIDS,taskName,taskDetails,stratDate,endDate,assignTo){

          let trow = document.createElement('tr');
          let td1 = document.createElement('td');
          let td2 = document.createElement('td');
          let td3 = document.createElement('td');
          let td4 = document.createElement('td');
          let td5 = document.createElement('td');
          let td6 = document.createElement('td');
          let td7 = document.createElement('td');


          td1.innerHTML = ++taskid;
          td2.innerHTML = taskIDS;
          td3.innerHTML = taskName;
          td4.innerHTML = taskDetails;
          td5.innerHTML = stratDate;
          td6.innerHTML = endDate;
          td7.innerHTML = assignTo;



          trow.appendChild(td1);
          trow.appendChild(td2);
          trow.appendChild(td3);
          trow.appendChild(td4);
          trow.appendChild(td5);
          trow.appendChild(td6);
          trow.appendChild(td7);
        

          tbody.appendChild(trow);


        }

        function addAllItemsTable(users){
            taskid = 0;
            tbody.innerHTML = "";

            users.forEach(element =>{
                addItemsToTable(element.Task_Id,element.Task_Name,element.Task_Details,element.Task_Start_Date,element.Task_End_Date,element.Task_Assign_To);
            });
            
        }


        function getAllDataOnce(data){


           
           // const databaseRef = ref(database);
           let que = query(ref(database, 'Tasks'), orderByChild("Task_Assign_To"), equalTo(data));
            
            get(que)
            .then((snapshot) => {
                
                let users = [];

                snapshot.forEach(childSnapshot =>{
                    
                    users.push(childSnapshot.val());
                   
                   
                  })
                
                  addAllItemsTable(users);
                  
                
              });

        }



    
        //window.onload = grabValue();
        window.onload = getAllDataOnce;

        // function getAllDataOnce(){
        //     const que = query(ref(database, 'Tasks'), orderByChild("Task_Assign_To"), equalTo("jenishchovatiya05@gmail.com"));
            
        //     get(que)
        //     .then((snapshot)=>{
                
        //         let users = [];
        //         snapshot.forEach(childSnapshot =>{  
        //             users.push(childSnapshot.val());
                   
                   
        //           });

        //           addAllItemsToTable(users);
        //     });

        // }
        

        
    </script>



</body>
</html>